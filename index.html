<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <title>Config Wemos IoT Relay</title>
      <style>
         body {
            background: #f5f6fa;
            color: #9c9c9c;
            font: 1rem "PT Sans", sans-serif;
            margin: 10px 20px
        }

        h1 {
            font-size: 1.5em
        }

        input {
            display: block;
            margin: 0 auto
        }

        form {
            width: 100%;
            max-width: 380px;
            display: inline-block
        }

        .form-container {
            text-align: center
        }

        input[type="password"],
        input[type="text"] {
            background: #fff;
            color: #a3a3a3;
            font: inherit;
            box-shadow: 0 6px 10px 0 rgba(0, 0, 0, 0.1);
            border: 0;
            outline: 0;
            padding: 12px 18px;
            width: 100%;
            margin: 20px 0;
            box-sizing: border-box;
            border-radius: 4px;
        }

        input[type="text"] {
            margin-bottom: 0;
        }

        select {
            color: #a3a3a3;
            font-size: 17px;
            width: 100%;
            margin-top: 20px;
            padding: 12px 18px;
            border: 0 !important;
            /* needed */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            box-shadow: 0 6px 10px 0 rgba(0, 0, 0, 0.1);
            /* SVG background image */
            background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='%238C98F2'><polygon points='0,0 100,0 50,50'/></svg>") no-repeat;
            background-size: 12px;
            background-position: calc(100% - 20px) center;
            background-repeat: no-repeat;
            background-color: white;
        }

        .btn {
            display: block;
            background: transparent;
            color: inherit;
            font: inherit;
            border: 0;
            outline: 0;
            padding: 0;
            transition: all 200ms ease-in;
            cursor: pointer;
            width: 100%
        }

        .btn-primary {
            background: #7f8ff4;
            color: #fff;
            box-shadow: 0 0 10px 2px rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            padding: 12px 36px
        }

        .btn-primary:hover {
            background: #6c7ff2
        }

        .btn-primary:active {
            background: #7f8ff4;
            box-shadow: inset 0 0 10px 2px rgba(0, 0, 0, 0.2)
        }

        #refresh-section {
            padding-top: 5px;
            text-align: left;
            height: 20px;
        }

        .hide {
            display: none;
        }

        .right {
            float: right;
        }

        .left {
            float: left;
        }
      </style>
   </head>
   <body>
      <div class="form-container">
         <h1>Connect to Wifi Network</h1>
         <p>Please provide wifi credentials to connect your wemos-iot-relay to network</p>
         <form action="/connect" method="POST">
            <input type="text" name="ssid" id="ssidText" placeholder="SSID" class="hide">
            <select name="ssid" id="ssidSelect">
                <option value="" disabled selected>Select a WiFi network</option>
                <option value="1">1</option>
                <option value="2">2</option>
            </select>
            <div id="refresh-section">
                <a id="refreshButton" href="#" class="left">refresh</a>
                <a id="backButton" href="#" class="right hide">back</a>
                <a id="changeInput" href="#" class="right">or write manually</a>
            </div>
            <input type="password" name="password" placeholder="Password">
            <input type="submit" value="Connect" class="btn btn-primary">
         </form>
      </div>
   </body>
<script type="text/javascript">
    var manuallySearch = false;
    var refreshButton = document.getElementById('refreshButton');
    var backButton = document.getElementById('backButton');
    var ssidText = document.getElementById('ssidText');
    var ssidSelect = document.getElementById('ssidSelect');
    var changeInput = document.getElementById('changeInput');
    var networks = null;
    var endpoint = 'http://192.168.4.1/scannetworks';

    var xhr = new XMLHttpRequest();
    xhr.onload = function() {
        if (xhr.status >= 200 && xhr.status < 300) {
            console.log('success!');
            networks = JSON.parse(xhr.responseText);
            console.log(networks);
        } else {
            console.log('error');
        }
    };


    refreshButton.onclick = function() {
        console.log('press');
        xhr.open('POST', endpoint);
        xhr.send();
    };

    changeInput.onclick = function() {
        backButton.classList.remove('hide');
        refreshButton.classList.add('hide');
        ssidText.classList.remove('hide');
        ssidSelect.classList.add('hide');
        changeInput.classList.add('hide');

        manuallySearch = true;
    };

    backButton.onclick = function() {
        backButton.classList.add('hide');
        refreshButton.classList.remove('hide');
        ssidText.classList.add('hide');
        ssidSelect.classList.remove('hide');
        changeInput.classList.remove('hide');

        manuallySearch = false;
    };
</script>
</html>